<!doctype html>
<html lang="pt-BR">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Comprando - <%= product.name %></title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
	<style>
		:root {
    --primary: #5d46f4;
    --primary-dark: #4a38c7;
    --bg: #f4f7ff;
    --text: #1f2937;
    --gray-light: #f9fafb;
}

body { 
    font-family: 'Inter', system-ui, sans-serif; 
    margin: 0; 
    padding: 40px 20px;
    color: var(--text); 
    background-color: var(--bg);
    display: flex;
    flex-direction: column;
    align-items: center;
}

h2 { 
    color: #111827; 
    margin-bottom: 24px; 
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card { 
    background: white;
    border: none;
    border-radius: 16px; 
    padding: 32px; 
    max-width: 800px; 
    width: 100%;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}

.row { 
    display: flex; 
    gap: 32px; 
    align-items: center; 
    flex-wrap: wrap; 
}

/* Área do QR Code */
.qr-container {
    text-align: center;
    flex: 1;
    min-width: 280px;
}

.qr { 
    width: 240px; 
    height: 240px; 
    margin: 0 auto 16px;
    background: white; 
    display: grid; 
    place-items: center; 
    border-radius: 12px; 
    border: 2px solid #eee;
    padding: 10px;
}

/* Detalhes do Pagamento */
.info-section { 
    flex: 1.2;
    min-width: 300px; 
}

.payment-label { 
    font-size: 12px; 
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6b7280; 
    margin-bottom: 4px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.payment-value { 
    font-size: 1.8rem; 
    font-weight: 800; 
    color: var(--primary);
    margin-bottom: 20px;
}

.payment-value::before {
  content: "R$";
  font-size: 1rem;
}

/* Status dinâmico */
#statusText {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 13px;
    background: #fef3c7;
    color: #92400e;
}

.status-paid { background: #dcfce7 !important; color: #166534 !important; }

/* Campo Copia e Cola */
.pix-box {
    background: var(--gray-light);
    border: 1px dashed #d1d5db;
    padding: 12px;
    border-radius: 8px;
    font-size: 13px;
    word-break: break-all;
    margin: 10px 0;
    color: #4b5563;
}

/* Botões */
.button-group { display: flex; gap: 10px; margin-top: 20px; }

button { 
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: var(--primary); 
    color: white; 
    padding: 12px; 
    border: 0; 
    border-radius: 8px; 
    font-weight: 600;
    cursor: pointer; 
    transition: 0.2s;
}

button:hover { background: var(--primary-dark); transform: translateY(-1px); }
button.secondary { background: #e5e7eb; color: #374151; }
button.secondary:hover { background: #d1d5db; }

/* Rodapé de Segurança */
.security-footer {
    margin-top: 24px;
    display: flex;
    gap: 20px;
    color: #9ca3af;
    font-size: 13px;
}
	</style>
	<script>
		let pollId = null;
		async function fetchJSON(url) {
			const res = await fetch(url);
			return await res.json();
		}
		function copy(text){ navigator.clipboard.writeText(text).then(()=>alert('Chave copiada!')); }
		function download(base64, name){ const a=document.createElement('a'); a.href='data:image/png;base64,'+base64; a.download=name; a.click(); }
		function startPolling(paymentId, acessoUrl){
			pollId = setInterval(async () => {
				try{
					const s = await fetchJSON('/status/' + paymentId);
					document.getElementById('statusText').textContent = s.status.toUpperCase();
					if (s.status === 'paid') {
						clearInterval(pollId);
						window.location.href = acessoUrl;
					}
				}catch(e){}
			}, 2500);
		}
		window.addEventListener('DOMContentLoaded', () => {
			startPolling('<%= data.payment_id %>', '<%= data.acesso_url %>');
		});
	</script>
</head>
<body>
    <h2><i class="fa-solid fa-shield-check" style="color: var(--primary)"></i> Finalizar Pagamento</h2>

    <div class="card">
		<img src="/images/mercado-pago-logo.png" style="margin: 0 auto 50px 65px;display: block;">
        <div class="row">
            <div class="qr-container">
                <div class="qr">
                    <img src="data:image/png;base64,<%= data.qr_code_base64 %>" alt="QR Pix" style="width:100%;" />
                </div>
                <p class="small"><i class="fa-solid fa-qrcode"></i> Escaneie o código acima com o app do seu banco</p>
            </div>

            <div class="info-section">
                <div class="payment-label">Valor a pagar</div>
                <div class="payment-value">R$ <%= data.amount.toFixed(2) %></div>

                <div class="payment-label"><i class="fa-solid fa-circle-dot"></i> Status do Pagamento</div>
                <div id="statusText" class="status"><i class="fa-solid fa-spinner fa-spin"></i> AGUARDANDO PAGAMENTO</div>

                <div style="margin-top:24px;">
                    <div class="payment-label">Pix Copia e Cola</div>
                    <div class="pix-box mono"><%= data.qr_code %></div>
                </div>

                <div class="button-group">
                    <button onclick="copy('<%= data.qr_code %>')">
                        <i class="fa-regular fa-copy"></i> Copiar Código
                    </button>
                    <button class="secondary" onclick="download('<%= data.qr_code_base64 %>','qrcode.png')">
                        <i class="fa-solid fa-download"></i> Salvar QR
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="security-footer">
        <span><i class="fa-solid fa-lock"></i> Pagamento Processado via Mercado Pago</span>
        <span><i class="fa-solid fa-check-double"></i> Ambiente 100% Seguro</span>
    </div>
</body>
</html>


